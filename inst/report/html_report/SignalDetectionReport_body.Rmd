{{pathogen}} {data-navmenu="Pathogen"}
=====================================

```{r}
if (is.null(params$data)) {
  data <- SignalDetectionTool::input_example
}
```

<!-- Pathogen without stratification page -->

Row {data-height=100}
-------------------------------------
### Data and Methods 

- Method used: `r names(available_algorithms()[which(available_algorithms() == params$method)])`
- Length of signal detection period: `r params$number_of_weeks` weeks
- Strata selected: `r paste(params$strata, collapse = ", ")`
- Intervention date: `r params$intervention_date`


```{r}

signals_agg <- params$signals_agg %>% dplyr::filter(pathogen == pathogen)
signals_padded <- params$signals_padded %>% dplyr::filter(pathogen == pathogen)

```

Row {.tabset}
-------------------------------------
### Signal Detection

#### Timeseries 

```{r, results='asis'}
results_analysis <- signals_padded %>%
  dplyr::filter(
    is.na(category),
    !is.na(alarms)
  )
```

In the signal detection period - last `r params$number_of_weeks` weeks available in the data - there were `r sum(results_analysis$cases)` cases of {{pathogen}} in `r params$country`.

Using the `r params$method` algorithm, `r sum(results_analysis$alarms)` `r ifelse(sum(results_analysis$n_alarms) == 1, 'signal', 'signals')` `r ifelse(sum(results_analysis$n_alarms) == 1, ' was', ' were')` detected.

```{r}
#| fig.cap=paste0("Number of {{pathogen}} cases by week and signals, ", params$country),

SignalDetectionTool::plot_time_series(
  signals_padded %>%
    dplyr::filter(is.na(category)),
  intervention_date = params$intervention_date,
  interactive = TRUE
)
```

#### Signal Detection Table

```{r}
txt <- NULL

if (sum(results_analysis$alarms, na.rm = TRUE) != 0) {
  SignalDetectionTool::build_signals_table(
    signals_padded %>%
      dplyr::filter(is.na(category)),
    format = "DataTable"
  )
} else {
  txt <- "No signals were detected."
}
```

```{r, results='asis'}
#|eval = is.character(txt)

cat(txt)
```


<!-- Strata subpages -->

```{r, results='asis'}
if(!is.null(params$strata)){
  src <- lapply(params$strata, function(j) {
    knitr::knit_expand('SignalDetectionReport_strata.rmd', 
                       strat = j, pathogen = "{{pathogen}}")
  })
  
  res <- knitr::knit_child(text = unlist(src), quiet = TRUE)
  cat(res, sep = "\n")
}
```
