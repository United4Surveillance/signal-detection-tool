{{pathogen}} {data-navmenu="Pathogen"}
=====================================

```{r eval=FALSE, include=FALSE}
if (!is.null(params$signals_padded) & !is.null(params$signals_agg)) {
  signals_agg <- params$signals_agg[["{{pathogen}}"]]
  signals_padded <- params$signals_padded[["{{pathogen}}"]]
} else {
  # code for processing user-given data
}
```

```{r}
# this chunk works when loading signals data
if (!is.null(signals_padded_list) & !is.null(signals_agg_list)) {
  signals_agg <- signals_agg_list[["{{pathogen}}"]]
  signals_padded <- signals_padded_list[["{{pathogen}}"]]
} else {
  # code for processing user-given data
}
```

### Signal detection

```{r, results='asis'}
results_analysis <- signals_padded %>%
  dplyr::filter(
    is.na(category),
    !is.na(alarms)
  )
```

In the signal detection period - last `r params$number_of_weeks` weeks available in the data - there were `r sum(results_analysis$cases)` cases of {{pathogen}} in `r params$country`.

Using the `r params$method` algorithm, `r sum(results_analysis$alarms)` `r ifelse(sum(results_analysis$n_alarms) == 1, 'signal', 'signals')` `r ifelse(sum(results_analysis$n_alarms) == 1, ' was', ' were')` detected.

```{r}
#| fig.cap = paste0("Number of {{pathogen}} cases by week and signals, ", params$country),
#| out.width = "100%"
SignalDetectionTool::plot_time_series(
  signals_padded %>%
    dplyr::filter(is.na(category)),
  intervention_date = params$intervention_date,
  interactive = params$interactive
)
```

### Signal Detection Table

```{r}
if (sum(results_analysis$alarms, na.rm = TRUE) != 0) {
  format <- ifelse(params$interactive, "DataTable", "Flextable")
  SignalDetectionTool::build_signals_table(
    signals_padded %>%
      dplyr::filter(is.na(category)),
    format = format
  )
} else {
  txt <- "No signals were detected."
  cat(txt)
}
```

### Strata {.tabset}

```{r, results="asis"}
src <- lapply(params$strata, function(j) {
  knitr::knit_expand('SignalDetectionMultiReport_strata_template.rmd', 
                     strat = j, pathogen = "{{pathogen}}")
})

res <- knitr::knit_child(text = unlist(src), quiet = TRUE)
cat(res, sep = "\n")
```


